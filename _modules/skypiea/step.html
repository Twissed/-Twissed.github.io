<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>skypiea.step &mdash; skypiea 1.38 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            skypiea
          </a>
              <div class="version">
                1.38
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pages/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/physics.html">Useful formulas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/stepclass.html">Step class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/plotstepclass.html">Plotting with the Step class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/io.html">Read and write data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/launcher.html">Automatic launchers and runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/noweight.html">No weight methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pages/todo.html">Todo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">skypiea</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">skypiea.step</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for skypiea.step</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Python package for beam dynamics analysis in laser-plasma acceleration</span>
<span class="sd">Author: D. Minenna</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.constants</span> <span class="k">as</span> <span class="nn">const</span>

<span class="c1"># skypiea</span>
<span class="kn">from</span> <span class="nn">.units</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.stepplotbeam</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.stepplotfield</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.stepwrite</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.list</span> <span class="kn">import</span> <span class="n">list_selection_beam</span> <span class="k">as</span> <span class="n">list_selection_beam</span>


<span class="k">class</span> <span class="nc">CallableVariable</span><span class="p">:</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dictionnary for the units of variables. Default: None</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dictionnary for the info of variables. Default: &#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># TODO : Corriger for arrays (Ek,...)</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new key to the Step class.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            step.set(</span>
<span class="sd">                    &#39;x&#39;,</span>
<span class="sd">                    np.array(position[&#39;x&#39;]),</span>
<span class="sd">                    units=&#39;m&#39;,</span>
<span class="sd">                    info=&#39;Positions x of the macro-particle of the beam&#39;</span>
<span class="sd">            )</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the key</span>
<span class="sd">            value (_type_): Any value/type wanted</span>
<span class="sd">            units (str, optional): Unit of the key. Defaults to None.</span>
<span class="sd">            info (str, optional): Description of the key. Defaults to &#39;&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">units</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">info</span><span class="p">})</span>

    <span class="c1"># TODO : Corriger delattr !!</span>
    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">setunits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span>

    <span class="k">def</span> <span class="nf">getunits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">getinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot; [&quot;</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="o">+</span> <span class="s2">&quot;] &quot;</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">final_unit</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">final_unit</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">or</span> <span class="n">final_unit</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="n">convert_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">final_unit</span><span class="p">)</span>


<div class="viewcode-block" id="Step"><a class="viewcode-back" href="../../pages/stepclass.html#skypiea.Step">[docs]</a><span class="k">class</span> <span class="nc">Step</span><span class="p">(</span><span class="n">CallableVariable</span><span class="p">,</span> <span class="n">StepPlotBeam</span><span class="p">,</span> <span class="n">StepPlotField</span><span class="p">,</span> <span class="n">StepWriteTraveWin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main Class for simulation parameters. Include beam, laser and plasma parameters at a given timestep.</span>


<span class="sd">    Examples</span>
<span class="sd">    -------</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Creation of the step class</span>
<span class="sd">        step = skypiea.Step()</span>

<span class="sd">        # Read data</span>
<span class="sd">        step = steps.getParticle(step,timestep,species=&#39;electrons&#39;,g=[10.,None])</span>

<span class="sd">        # Examples</span>
<span class="sd">        print(f&quot;N particle: {step.N}&quot;)</span>
<span class="sd">        print(f&quot;Positions {step.x} [m]&quot;)</span>
<span class="sd">        step.print(&#39;emit_norm_rms_y&#39;)</span>
<span class="sd">        step.print(&#39;charge&#39;)</span>
<span class="sd">        step.print(&#39;dt&#39;)</span>
<span class="sd">        print(f&quot;Convert dt: {step.convert(&#39;dt&#39;,&#39;ps&#39;)} [ps]&quot;)</span>


<span class="sd">    .. code-block:: python</span>

<span class="sd">        step = skypiea.read_dst(&quot;treacewin.dst&quot;)</span>


<span class="sd">    Main keys</span>
<span class="sd">    ----</span>

<span class="sd">        * **x** (*float*) - Array of position in x, in m</span>
<span class="sd">        * **y** (*float*) - Array of position in y, in m</span>
<span class="sd">        * **z** (*float*) - Array of position in z, in m</span>
<span class="sd">        * **ux** (*float*) - Normalised momenta x :math:`u_x = \gamma v_x /c = \gamma beta_x` of the macro-particle of the beam</span>
<span class="sd">        * **uy** (*float*) - Normalised momenta y :math:`u_y = \gamma v_y /c = \gamma beta_y` of the macro-particle of the beam</span>
<span class="sd">        * **uy** (*float*) - Normalised momenta z :math:`u_z = \gamma v_z /c = \gamma beta_z` of the macro-particle of the beam</span>
<span class="sd">        * **w** (*float*) - Weighs of the macro-particles in term of particles, in number of particles per macro-particles&#39;</span>
<span class="sd">        * **g** (*float*) - Lorentz factor of every single macro-particles</span>
<span class="sd">        * **Ek** (*float*) - Relativistic kinetic energy of macro-particles</span>

<span class="sd">    .. note::</span>

<span class="sd">        Keys are only available if defined from read or set functions.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Simulation class of skypiea at a given timestep.&quot;</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create copy of Step class</span>

<span class="sd">        Returns:</span>
<span class="sd">            Step: copy of Step class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">step_new</span> <span class="o">=</span> <span class="n">Step</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">step_new</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">step_new</span>

    <span class="k">def</span> <span class="nf">keep_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexes_to_keep</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduce the particles arrays with given indexes. Keep intact the dicts units and info.</span>
<span class="sd">        Such as:     self.w = self.w[indexes_to_keep]</span>

<span class="sd">        Args:</span>
<span class="sd">            indexes_to_keep (int): indexes to keep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;ux&quot;</span><span class="p">,</span> <span class="s2">&quot;uy&quot;</span><span class="p">,</span> <span class="s2">&quot;uz&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;Ek&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">indexes_to_keep</span><span class="p">],</span>
                <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
                <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">setpositionsmomenta</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">ux</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">uy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">uz</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">w</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set position and momenta of the beam</span>

<span class="sd">        Args:</span>
<span class="sd">            x (np.ndarray): Positions x of the macro-particle of the beam in m</span>
<span class="sd">            y (np.ndarray): Positions y of the macro-particle of the beam in m</span>
<span class="sd">            z (np.ndarray): Positions z of the macro-particle of the beam in m</span>
<span class="sd">            ux (np.ndarray): Normalised momenta x :math:`u_x = \gamma v_x /c = \gamma beta_x` of the macro-particle of the beam</span>
<span class="sd">            uy (np.ndarray): Normalised momenta y :math:`u_y = \gamma v_y /c = \gamma beta_y` of the macro-particle of the beam</span>
<span class="sd">            uz (np.ndarray): Normalised momenta z :math:`u_z = \gamma v_z /c = \gamma beta_z` of the macro-particle of the beam</span>
<span class="sd">            w (np.ndarray): Weighs of the macro-particles in term of number of particles</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Positions x of the macro-particle of the beam.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Positions y of the macro-particle of the beam.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;z&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Positions z of the macro-particle of the beam.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;ux&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ux</span><span class="p">),</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Normalised momenta x (ux=gamma*vx/c) of the macro-particle of the beam.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;uy&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uy</span><span class="p">),</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Normalised momenta y (uy=gamma*vy/c) of the macro-particle of the beam.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;uz&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uz</span><span class="p">),</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Normalised momenta z (uz=gamma*vz/c) of the macro-particle of the beam.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;Nb particle per macro-particle&quot;</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Weighs of the macro-particles in term of particles.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">getbeam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate all the beam data.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            step.getbeam(x=[-12*1e-6,12*1e-6], g=[200,None],Ek_avg=[-50,50])</span>


<span class="sd">        Range arguments accepted for selection</span>
<span class="sd">        --------------------------------------</span>

<span class="sd">            * **x** (*float*) - Array of position in x, in m</span>
<span class="sd">            * **y** (*float*) - Array of position in y, in m</span>
<span class="sd">            * **z** (*float*) - Array of position in z, in m</span>
<span class="sd">            * **ux** (*float*) - Normalised momenta x :math:`u_x = \gamma v_x /c = \gamma beta_x` of the macro-particle of the beam</span>
<span class="sd">            * **uy** (*float*) - Normalised momenta y :math:`u_y = \gamma v_y /c = \gamma beta_y` of the macro-particle of the beam</span>
<span class="sd">            * **uy** (*float*) - Normalised momenta z :math:`u_z = \gamma v_z /c = \gamma beta_z` of the macro-particle of the beam</span>
<span class="sd">            * **w** (*float*) - Weighs of the macro-particles in term of particles, in number of particles per macro-particles</span>
<span class="sd">            * **g** (*float*) - Lorentz factor of every single macro-particles</span>
<span class="sd">            * **Ek** (*float*) - Relativistic kinetic energy of macro-particles</span>



<span class="sd">        .. note::</span>

<span class="sd">            * All the above arguments can be added with the &#39;_avg&#39; suffix to force the selection to be performed around the mean value.</span>
<span class="sd">            * Variables self.w, self.ux, self.uy, self.uz, self.x, self.y and self.z must have be defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">verbose</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># TODO: Add security self.w, self.ux, self.uy, self.uz, self.x, self.y and self.z</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;g&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Lorentz factor of every single macro-particles&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;Ek&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">m_e</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">e</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Relativistic kinetic energy of macro-particles&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># TODO: Add weight selection and reducer (if N too high)</span>

        <span class="c1"># Selection of particles</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">list_selection_beam</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">indexes_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">keep_index</span><span class="p">(</span><span class="n">indexes_to_keep</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">indexes_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">keep_index</span><span class="p">(</span><span class="n">indexes_to_keep</span><span class="p">)</span>

            <span class="n">name_avg</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_avg&quot;</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_avg</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name_avg</span> <span class="o">+</span> <span class="s2">&quot;_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_avg</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_avg</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">indexes_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean</span> <span class="o">&gt;=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_avg</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">keep_index</span><span class="p">(</span><span class="n">indexes_to_keep</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_avg</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">indexes_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean</span> <span class="o">&lt;=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_avg</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">keep_index</span><span class="p">(</span><span class="n">indexes_to_keep</span><span class="p">)</span>

        <span class="c1"># Speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;vz&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uz</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Speed z (lab frame) of the macro-particle of the beam.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Total charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="s2">&quot;charge&quot;</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e12</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pC&quot;</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Total charge of the beam&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Number of particles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Total number of macro-particle the beam&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No beam!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Energy MeV</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_avg&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ek</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Mean energy of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_med&quot;</span><span class="p">,</span>
                <span class="n">weighted_med</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ek</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Median (med) energy of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_std&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ek</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Standard deviation (std) of the kinetic energy of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_mad&quot;</span><span class="p">,</span>
                <span class="n">weighted_mad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ek</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Median absolute deviation (mad) of the kinetic energy of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_std_perc&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ek_std</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ek_avg</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Energy spread Ek_std/Ek_mean*100 of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_mad_perc&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ek_mad</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ek_med</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;%&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Energy spread Ek_mad/Ek_med*100 of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># gamma beam (Lorentz factor)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;g_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Mean Lorentz factor of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;g_med&quot;</span><span class="p">,</span>
                <span class="n">weighted_med</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Median (med) Lorentz factor of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;g_std&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Standard deviation (std) of the Lorentz factor of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;g_mad&quot;</span><span class="p">,</span>
                <span class="n">weighted_mad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Median absolute deviation (mad) of the Lorentz factor of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Bunch length</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_x&quot;</span><span class="p">,</span> <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS size in x&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_y&quot;</span><span class="p">,</span> <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS size in y&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_z&quot;</span><span class="p">,</span> <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS size in z&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;sigma_ux&quot;</span><span class="p">,</span> <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS size in ux&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;sigma_uy&quot;</span><span class="p">,</span> <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS size in uy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;sigma_uz&quot;</span><span class="p">,</span> <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS size in uz&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_Ek&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ek</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS size of the kinetic energy. Same as Ek_std the standard deviation (std) of the kinetic energy of the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Average mean velocity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;betaz_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vz</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Average normalized velocity &lt;$\beta_z = vz/c$&gt; in z&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># dp/p</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;p&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">betaz_ave</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Particle momenta $\gamma &lt;\beta_z&gt; c$&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;p_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Average momenta $&lt;p&gt;$&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;dp&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ave</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ave</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Particle momenta variation $\delta p/p$&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;dp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;$&lt;\delta p/p&gt;$&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_dp&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Standard deviation (std) of the particle momenta variation in percentage&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># xp and yp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ux</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Trace momentum x&#39; the beam&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;yp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uy</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Trace momentum y&#39; the beam&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Divergences</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_xp&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS angle x&#39; the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_yp&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;RMS angle y&#39; the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;x_divergence&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Divergence of the trace momentum x&#39; the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;y_divergence&quot;</span><span class="p">,</span>
                <span class="n">weighted_std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Divergence of the trace momentum y&#39; the beam&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Center of mass &lt;x&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;x_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Center of mass in x the beam (average position)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;y_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Center of mass in y the beam (average position)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;z_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Center of mass in z the beam (average position)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># &lt;x**2&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xx_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ave</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x^2&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;yy_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ave</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y^2&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># &lt;ux&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;ux_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Average normalised momentum ux (with ux=gamma*vx/c=gamma*beta_x)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;uy_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Average normalised momentum uy (with uy=gamma*vy/c=gamma*beta_y)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;uz_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Average normalised momentum uz (with uz=gamma*vz/c=gamma*beta_z)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Differente normalisation !!</span>
            <span class="c1"># &lt;ux**2 &gt;</span>
            <span class="c1"># self.set(&#39;uxux_ave&#39;,weighted_ave((self.ux-self.ux_ave)**2,self.w),info=&quot;&lt;ux**2 &gt; with the normalised momentum ux&quot;)</span>
            <span class="c1"># self.set(&#39;uyuy_ave&#39;,weighted_ave((self.uy-self.uy_ave)**2,self.w),info=&quot;&lt;uy**2 &gt; with the normalised momentum uy&quot;)</span>
            <span class="c1"># &lt;x ux&gt;</span>
            <span class="c1"># self.set(&#39;xux_ave&#39;,weighted_ave((self.x-self.x_ave)*(self.ux-self.ux_ave),self.w), units=&#39;m.rad&#39;,info=&quot;&lt;x ux&gt;&quot;)</span>
            <span class="c1"># self.set(&#39;yuy_ave&#39;,weighted_ave((self.y-self.y_ave)*(self.uy-self.uy_ave),self.w), units=&#39;m.rad&#39;,info=&quot;&lt;y uy&gt;&quot;)</span>
            <span class="c1"># Emittance</span>
            <span class="c1"># self.set(&#39;emit_Nrms_x&#39;,np.sqrt(np.abs(self.xx_ave*self.uxux_ave-self.xux_ave**2))*1e6,units=&#39;mm.mrad&#39;,info=f&quot;Normalised RMS emittance in x&quot;)</span>
            <span class="c1"># self.set(&#39;emit_Nrms_y&#39;,np.sqrt(np.abs(self.yy_ave*self.uyuy_ave-self.yuy_ave**2))*1e6,units=&#39;mm.mrad&#39;,info=f&quot;Normalised RMS emittance in y&quot;)</span>

            <span class="c1"># &lt;x&#39;&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Average divergence &lt;x&#39;&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;yp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Average divergence &lt;y&#39;&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># &lt;x&#39;*2&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xpxp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xp_ave</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x&#39;^2&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;ypyp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp_ave</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x&#39;^2&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># &lt;x x&#39;&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xxp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x x&#39;&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;yyp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y y&#39;&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># trace emittance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_rms_x&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xx_ave</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xpxp_ave</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xxp_ave</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pi.mm.mrad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Unnormalized trace emittance RMS $\epsilon_{xx&#39;}$ in x&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_rms_y&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yy_ave</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ypyp_ave</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yyp_ave</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pi.mm.mrad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Unnormalized trace emittance RMS $\epsilon_{yy&#39;}$ in y&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_norm_rms_x&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_ave</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">betaz_ave</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pi.mm.mrad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Normalized trace emittance RMS $\gamma \beta \epsilon_{xx&#39;}$ in x&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_norm_rms_y&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_ave</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">betaz_ave</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pi.mm.mrad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Normalized trace emittance RMS $\gamma \beta \epsilon_{yy&#39;}$ in y&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># * Twiss parameters x, y</span>

            <span class="c1"># beta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;beta_x&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xx_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_x</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mm/mrad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Beam Twiss coefficient $</span><span class="se">\b</span><span class="s2">eta_x$ in x&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;beta_y&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yy_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_y</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mm/mrad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Beam Twiss coefficient $</span><span class="se">\b</span><span class="s2">eta_y$ in y&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># gamma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;gamma_x&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xpxp_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_x</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mrad/mm&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Beam Twiss coefficient $\gamma_x$ in x&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;gamma_y&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ypyp_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_y</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mrad/mm&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Beam Twiss coefficient $\gamma_y$ in y&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;alpha_x&quot;</span><span class="p">,</span>
                <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xxp_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_x</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Beam Twiss coefficient $</span><span class="se">\a</span><span class="s2">lpha_x$ in x&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;alpha_y&quot;</span><span class="p">,</span>
                <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">yyp_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_y</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Beam Twiss coefficient $</span><span class="se">\a</span><span class="s2">lpha_y$ in y&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># * dQ/dE histogramm</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">H</span><span class="p">,</span> <span class="n">xpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist1D</span><span class="p">(</span><span class="s2">&quot;Ek&quot;</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">x_in_fwhm</span> <span class="o">=</span> <span class="n">xpos</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">H</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">fwhm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_in_fwhm</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_in_fwhm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="n">xpos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="n">x_in_fwhm</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">fwhm</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_hist_yaxis&quot;</span><span class="p">,</span>
                <span class="n">H</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pC&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Ordinate axis for dQ/dE with E the relativistic kinetic energy (dE=1)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_hist_xaxis&quot;</span><span class="p">,</span>
                <span class="n">xpos</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Abscissa axis for dQ/dE with E the relativistic kinetic energy (dE=1)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_hist_peak&quot;</span><span class="p">,</span>
                <span class="n">xpos</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">H</span><span class="p">)],</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Peak of dQ/dE with E the relativistic kinetic energy (dE=1)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;Ek_hist_fwhm&quot;</span><span class="p">,</span>
                <span class="n">fwhm</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;MeV&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;The full width at half maximum (FWHM) of dQ/dE with E the relativistic kinetic energy (dE=1)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># * Beam sigma matrix</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xy_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x y&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xyp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x y&#39;&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;yxp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y x&#39;&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xpyp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xp_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y x&#39;&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xz_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x z&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xdp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x dp/p&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xpz_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xp_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x&#39; z&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;xpdp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xp_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;x&#39; dp/p&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;yz_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y z&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;ydp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y dp/p&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;ypz_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y&#39; z&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;ypdp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">yp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yp_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;y&#39; dp/p&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;zz_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;z z&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;zdp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m.rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;z dp/p&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;dpdp_ave&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_ave</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_ave</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;rad^2&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&lt;dp/p dp/p&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">sigma_matrix</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xx_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xxp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xy_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xyp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xdp_ave</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xxp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xpxp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yxp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xpyp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xpz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xpdp_ave</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xy_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yxp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yy_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yyp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ydp_ave</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xyp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xpyp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yyp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ypyp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ypz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ypdp_ave</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xpz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">yz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ypz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zz_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zdp_ave</span><span class="p">,</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xdp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xpdp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ydp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ypdp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zdp_ave</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dpdp_ave</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;sigma_matrix&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sigma_matrix</span><span class="p">),</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Beam sigma matrix (not multiplied by 5!)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># * z emittances</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_rms_z&quot;</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zz_ave</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpdp_ave</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">zdp_ave</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pi.mm.mrad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Unnormalized trace rms emittance $\epsilon_{z\delta p/p&#39;}$ in z&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_norm_rms_z&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_z</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_ave</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">betaz_ave</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pi.mm.%&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Normalized trace rms emittance $\gamma \beta \epsilon_{z\delta p/p&#39;}$ in z&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># * Twiss parameters z</span>

            <span class="c1"># beta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;beta_z&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zz_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_z</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mm/pi/%&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Beam Twiss coefficient $\beta_z$ in z&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># gamma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;gamma_z&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dpdp_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_z</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mrad/mm&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Beam Twiss coefficient $\gamma_z$ in z&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;alpha_z&quot;</span><span class="p">,</span>
                <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">zdp_ave</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_rms_z</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Beam Twiss coefficient $\alpha_z$ in z&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># * 4D and 6D emittances</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_norm_rms_4D&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emit_norm_rms_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_norm_rms_y</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(pi.mm.mrad)$^2$&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Normalized 4D trace rms emittance $\epsilon$ (x-x&#39;-y-y&#39;)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;emit_norm_rms_6D&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emit_norm_rms_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_norm_rms_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit_norm_rms_z</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(pi.mm.mrad)$^3$&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Normalized 6D trace rms emittance $\epsilon$ (x-x&#39;-y-y&#39;-z-\delta p / p)&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># * Dispersions</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;x_dispersion&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Horizontal x dispersion&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                <span class="s2">&quot;y_dispersion&quot;</span><span class="p">,</span>
                <span class="n">weighted_ave</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">),</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/rad&quot;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="s2">&quot;Vertical y dispersion&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">rotationXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Counterclockwise rotate the x-y plan to a given angle</span>


<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            # 90 degree rotation of the beam</span>
<span class="sd">            step_new = step.rotationXY(90*np.pi/180)</span>

<span class="sd">        Args:</span>
<span class="sd">            angle (float): Angle of the counterclockwise rotation, in rad</span>

<span class="sd">        Returns:</span>
<span class="sd">            step: New step class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">step_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">x_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">y_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

        <span class="n">ux_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">uy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">uy_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

        <span class="n">step_new</span><span class="o">.</span><span class="n">setpositionsmomenta</span><span class="p">(</span>
            <span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">ux_new</span><span class="p">,</span> <span class="n">uy_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="p">)</span>
        <span class="n">step_new</span><span class="o">.</span><span class="n">getbeam</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">step_new</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Damien Minenna.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>